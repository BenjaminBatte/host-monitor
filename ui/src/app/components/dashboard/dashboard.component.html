<div id="top"></div>

<div class="dashboard-container">
  <header class="dashboard-header">
    <h1 class="dashboard-title">üåê Live Host Monitoring Dashboard</h1>

    <div class="stats-and-export">
      <!-- Stats -->
      <div class="stats-summary">
        <div class="stat-box up">
          <span class="stat-value">{{ getUpHostsCount() }}</span>
          <span class="stat-label">Hosts Up</span>
        </div>
        <div class="stat-box down">
          <span class="stat-value">{{ getDownHostsCount() }}</span>
          <span class="stat-label">Hosts Down</span>
        </div>
        <div class="stat-box neutral">
          <span class="stat-value">{{ hostEntries.length }}</span>
          <span class="stat-label">Total Hosts</span>
        </div>
      </div>

      <!-- Actions -->
      <div class="action-buttons">
        <button class="primary-button blue" (click)="exportToCSV()">
          üì§ Export Report
        </button>
        <button class="primary-button green" (click)="scrollToHistory()">
          üìú View History
        </button>
      </div>
    </div>
  </header>

  <!-- Loading -->
  <div *ngIf="hostEntries.length === 0" class="loading">
    <div class="spinner"></div>
    <p>Connecting to WebSocket & waiting for data...</p>
  </div>

  <!-- Threshold Settings -->
  <div class="threshold-settings">
    <label for="thresholdSlider" title="Slide to increase or decrease the latency threshold">
      Latency Threshold: {{ threshold }} ms
    </label>

    <input
      type="range"
      id="thresholdSlider"
      [(ngModel)]="threshold"
      min="1"
      max="1000"
      class="threshold-slider"
      (input)="updateThreshold()"
      title="Adjust to change latency threshold"
    />
  </div>

  <!-- Main Content -->

  <div *ngIf="hostEntries.length > 0">
    <!-- Chart -->
    <h2 class="chart-heading">Host Availability Summary</h2>
    <div class="chart-container">
      <canvas
        baseChart
        [data]="pieChartData"
        [labels]="pieChartLabels"
        type="pie"
        [options]="pieChartOptions">
      </canvas>
    </div>

   
<!-- Host Cards Section -->
<div class="cards-section">
  <h2 class="cards-heading">Real-Time Host Status</h2>
  <p class="cards-subheading">Live availability, latency, and uptime for all monitored hosts</p>

  <div class="card-grid">
    <app-host-card
      *ngFor="let host of hostEntries; trackBy: trackByHost"
      [host]="host[0]"
      [data]="host[1]">
    </app-host-card>
  </div>
</div>


    <!-- History Table -->
    <div id="history-section" class="history-table">
        <h2>Recent Status History</h2>
      <div [class.compact-mode]="isCompactMode" class="history-table-wrapper">
        <table>
          <thead>
            <tr>
              <th class="sortable">Host</th>
              <th class="sortable">Status</th>
              <th class="sortable">Latency</th>
              <th class="sortable">Last Checked</th>
              <th class="sortable">Uptime</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let host of hostEntries; trackBy: trackByHost">
              <td>{{ host[0] }}</td>
              <td>
                <span class="status-badge" [ngClass]="{ up: host[1].up, down: !host[1].up }">
                  <i class="fas" [ngClass]="host[1].up ? 'fa-check-circle' : 'fa-times-circle'"></i>
                  {{ host[1].up ? 'UP' : 'DOWN' }}
                </span>
              </td>
              <td>{{ host[1].latency }} ms</td>
              <td>{{ host[1].lastChecked | date:'mediumTime' }}</td>
              <td>
                <div class="uptime-bar">
                  <div
                    class="uptime-fill"
                    [style.width.%]="(host[1].successCount / host[1].totalChecks) * 100">
                  </div>
                  <span>
                    {{ (host[1].successCount / host[1].totalChecks) * 100 | number:'1.1-1' }}%
                  </span>
                </div>
              </td>
            </tr>
          </tbody>
        </table>

        <!-- History actions -->
        <div class="history-actions">
          <button class="primary-button green" (click)="scrollToHistoryTop()">‚¨ÜÔ∏è Back to History Top</button>
          <button class="primary-button blue" (click)="scrollToTop()">üè† Back to Top</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Floating Back-to-Top FAB -->
<button
  class="scroll-top-fab"
  *ngIf="showScrollTop"
  (click)="scrollToTop()"
  aria-label="Back to top">
  ‚Üë
</button>
