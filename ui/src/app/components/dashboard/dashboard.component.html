<div class="dashboard-container">
  <header class="dashboard-header">
    <h1 class="dashboard-title">üåê Live Host Monitoring Dashboard</h1>

    <div class="stats-and-export">
      <div class="stats-summary">
        <div class="stat-box up">
          <span class="stat-value">{{ getUpHostsCount() }}</span>
          <span class="stat-label">Hosts Up</span>
        </div>
        <div class="stat-box down">
          <span class="stat-value">{{ getDownHostsCount() }}</span>
          <span class="stat-label">Hosts Down</span>
        </div>
        <div class="stat-box neutral">
          <span class="stat-value">{{ hostEntries.length }}</span>
          <span class="stat-label">Total Hosts</span>
        </div>
      </div>

      <div class="export-button-wrapper">
        <button class="export-button" (click)="exportToCSV()">
          üì§ Export Uptime Data
        </button>
      </div>
    </div>
  </header>

  <div *ngIf="hostEntries.length === 0" class="loading">
    <div class="spinner"></div>
    <p>Connecting to WebSocket & waiting for data...</p>
  </div>
<div class="threshold-settings">
  <label for="thresholdSlider" title="Slide to increase or decrease the latency threshold">
    Latency Threshold: {{ threshold }} ms
  </label>

  <input
    type="range"
    id="thresholdSlider"
    [(ngModel)]="threshold"
    min="1"
    max="1000"
    class="threshold-slider"
    (input)="updateThreshold()"
    title="Adjust to change latency threshold"
  />
</div>


  <div *ngIf="hostEntries.length > 0">
    <!-- Chart -->
    <div class="chart-container">
      <div style="display: block;">
        <canvas baseChart
                [data]="pieChartData"
                [labels]="pieChartLabels"
                type="pie"
                [options]="pieChartOptions">
        </canvas>
      </div>
    </div>

    <!-- Host Cards -->
    <div class="card-grid">
      <app-host-card
        *ngFor="let host of hostEntries"
        [host]="host[0]"
        [data]="host[1]">
      </app-host-card>
    </div>

    <!-- History Table -->
    <div class="history-table">
      <h2>Recent Status History</h2>
      <div [class.compact-mode]="isCompactMode" class="history-table-wrapper">
        <table>
          <thead>
            <tr>
              <th class="sortable">Host</th>
              <th class="sortable">Status</th>
              <th class="sortable">Latency</th>
              <th class="sortable">Last Checked</th>
              <th class="sortable">Uptime</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let host of hostEntries">
              <td>{{ host[0] }}</td>
              <td>
                <span class="status-badge" [ngClass]="{ up: host[1].up, down: !host[1].up }">
                  <i class="fas" [ngClass]="host[1].up ? 'fa-check-circle' : 'fa-times-circle'"></i>
                  {{ host[1].up ? 'UP' : 'DOWN' }}
                </span>
              </td>
              <td>{{ host[1].latency }} ms</td>
              <td>{{ host[1].lastChecked | date:'mediumTime' }}</td>
              <td>
                <div class="uptime-bar">
                  <div class="uptime-fill"
                       [style.width.%]="(host[1].successCount / host[1].totalChecks) * 100">
                  </div>
                  <span>
                    {{ (host[1].successCount / host[1].totalChecks) * 100 | number:'1.1-1' }}%
                  </span>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
